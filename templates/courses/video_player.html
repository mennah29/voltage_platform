{% extends 'base.html' %}

{% block title %}{{ lecture.title }}{% endblock %}

{% block content %}
<div class="container" style="padding: 40px 0;">
    <!-- Breadcrumb -->
    <div style="margin-bottom: 20px;">
        <a href="{% url 'courses:chapter_list' %}" style="color: var(--text-muted);">Ø§Ù„ÙØµÙˆÙ„</a>
        <span style="color: var(--text-muted); margin: 0 10px;">/</span>
        <a href="{% url 'courses:lecture_list' lecture.chapter.id %}" style="color: var(--text-muted);">{{
            lecture.chapter.title }}</a>
        <span style="color: var(--text-muted); margin: 0 10px;">/</span>
        <span>{{ lecture.title }}</span>
    </div>

    <h1 style="margin-bottom: 30px;">{{ lecture.title }}</h1>

    <!-- Video Player with Watermark -->
    <div class="video-container" id="video-player">
        <!-- Watermark Overlay -->
        <div class="watermark">{{ student_phone }}</div>

        <!-- Video Embed (Vimeo/YouTube) -->
        {% if 'vimeo' in lecture.video_url %}
        <iframe src="{{ lecture.get_embed_url }}?title=0&byline=0&portrait=0"
            allow="autoplay; fullscreen; picture-in-picture" allowfullscreen>
        </iframe>
        {% elif 'youtube' in lecture.video_url or 'youtu.be' in lecture.video_url %}
        <iframe src="{{ lecture.get_embed_url }}" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
        </iframe>
        {% else %}
        <iframe src="{{ lecture.get_embed_url }}" allowfullscreen></iframe>
        {% endif %}
    </div>

    <!-- Tabs -->
    <div style="margin-top: 30px;">
        <div class="tabs">
            <button class="tab active" onclick="showTab('description')">ğŸ“ Ø§Ù„ÙˆØµÙ</button>
            <button class="tab" onclick="showTab('pdf')">ğŸ“„ Ø§Ù„Ù…Ù„Ø²Ù…Ø©</button>
            <button class="tab" onclick="showTab('quiz')">ğŸ“ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
        </div>

        <!-- Description Tab -->
        <div id="tab-description" class="tab-content card" style="margin-top: 20px;">
            <h3>Ø¹Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</h3>
            <p>{{ lecture.description|default:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" }}</p>
            <p style="color: var(--text-muted); margin-top: 15px;">
                â±ï¸ Ù…Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: {{ lecture.duration }} Ø¯Ù‚ÙŠÙ‚Ø©
            </p>
        </div>

        <!-- PDF Tab -->
        <div id="tab-pdf" class="tab-content card" style="margin-top: 20px; display: none;">
            {% if lecture.pdf_file %}
            <h3>ğŸ“„ Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</h3>
            <p>Ø­Ù…Ù‘Ù„ Ø§Ù„Ù…Ù„Ø²Ù…Ø© Ù„Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ†</p>
            <a href="{{ lecture.pdf_file.url }}" class="btn btn-primary" style="margin-top: 15px;" target="_blank">
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø²Ù…Ø© PDF
            </a>
            {% else %}
            <p style="color: var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø²Ù…Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</p>
            {% endif %}
        </div>

        <!-- Quiz Tab -->
        <div id="tab-quiz" class="tab-content card" style="margin-top: 20px; display: none;">
            {% if quiz %}
            <h3>ğŸ“ Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</h3>
            <p>Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…Ùƒ Ù„Ù„Ù…Ø­ØªÙˆÙ‰</p>
            <ul style="color: var(--text-muted); margin: 15px 0;">
                <li>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: {{ quiz.questions_count }}</li>
                <li>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­: {{ quiz.time_limit }} Ø¯Ù‚ÙŠÙ‚Ø©</li>
                <li>Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: {{ quiz.passing_score }}%</li>
            </ul>
            <a href="{% url 'exams:quiz_intro' quiz.id %}" class="btn btn-primary">
                Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† âš¡
            </a>
            {% else %}
            <p style="color: var(--text-muted);">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù† Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ø¹Ø¯</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));

        // Show selected tab
        document.getElementById('tab-' + tabName).style.display = 'block';
        event.target.classList.add('active');
    }

    // Track video progress
    document.addEventListener('DOMContentLoaded', function () {
        trackVideoProgress({{ lecture.id }}, document.getElementById('video-player'));
});
</script>
{% endblock %}