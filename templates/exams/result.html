{% extends 'base.html' %}

{% block title %}Ø§Ù„Ù†ØªÙŠØ¬Ø© - {{ result.quiz.title }}{% endblock %}

{% block content %}
<div class="container" style="padding: 60px 0;">
    <div style="max-width: 700px; margin: 0 auto;">
        <!-- Result Card -->
        <div class="card result-card {% if result.passed %}passed{% else %}failed{% endif %}">
            <div class="result-icon">
                {% if result.passed %}ğŸ‰{% else %}âš ï¸{% endif %}
            </div>

            <div class="result-score text-gradient">
                {{ result.percentage|floatformat:0 }}%
            </div>

            <div class="result-message">
                {% if result.passed %}
                <span style="color: var(--success);">Ù…Ø¨Ø±ÙˆÙƒ! Ù†Ø¬Ø­Øª ÙÙŠ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† âš¡</span>
                <p style="color: var(--text-muted); margin-top: 10px;">ØªÙ… Ø´Ø­Ù† Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø¹Ù„Ù…ÙŠ ğŸ”‹+10</p>
                {% else %}
                <span style="color: var(--danger);">Ø§Ù„Ø¬Ù‡Ø¯ Ù…Ù†Ø®ÙØ¶ âš ï¸</span>
                <p style="color: var(--text-muted); margin-top: 10px;">Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ÙˆØ­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ</p>
                {% endif %}
            </div>

            <!-- Stats -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px;">
                <div class="card" style="text-align: center; padding: 20px;">
                    <span style="font-size: 2rem; color: var(--success);">{{ result.correct_answers }}</span>
                    <p style="color: var(--text-muted);">Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©</p>
                </div>
                <div class="card" style="text-align: center; padding: 20px;">
                    <span style="font-size: 2rem;">{{ result.total_questions }}</span>
                    <p style="color: var(--text-muted);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p>
                </div>
                <div class="card" style="text-align: center; padding: 20px;">
                    <span style="font-size: 2rem;">{{ result.time_taken|divisibleby:60 }}:{{
                        result.time_taken|divisibleby:60|add:0 }}</span>
                    <p style="color: var(--text-muted);">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚</p>
                </div>
            </div>
        </div>

        <!-- Answers Review -->
        {% if questions_with_answers %}
        <div style="margin-top: 40px;">
            <h2>ğŸ“‹ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</h2>

            {% for item in questions_with_answers %}
            <div class="card"
                style="margin-top: 20px; border-right: 4px solid {% if item.is_correct %}var(--success){% else %}var(--danger){% endif %};">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: var(--text-muted);">Ø§Ù„Ø³Ø¤Ø§Ù„ {{ forloop.counter }}</span>
                    {% if item.is_correct %}
                    <span style="color: var(--success);">âœ… ØµØ­ÙŠØ­</span>
                    {% else %}
                    <span style="color: var(--danger);">âŒ Ø®Ø·Ø£</span>
                    {% endif %}
                </div>

                <p style="font-weight: 600; margin-bottom: 15px;">{{ item.question.text }}</p>

                <div style="display: grid; gap: 10px;">
                    {% for option_key, option_label in "a:Ø£,b:Ø¨,c:Ø¬,d:Ø¯"|make_list %}
                    {% endfor %}

                    <div style="padding: 10px 15px; border-radius: 8px;
                        {% if item.question.correct_answer == 'a' %}background: rgba(0,200,83,0.2);{% endif %}
                        {% if item.student_answer == 'a' and item.question.correct_answer != 'a' %}background: rgba(255,82,82,0.2);{% endif %}
                    ">
                        <span style="font-weight: 600;">Ø£)</span> {{ item.question.option_a }}
                        {% if item.question.correct_answer == 'a' %}âœ…{% endif %}
                        {% if item.student_answer == 'a' and item.question.correct_answer != 'a' %}âŒ{% endif %}
                    </div>

                    <div style="padding: 10px 15px; border-radius: 8px;
                        {% if item.question.correct_answer == 'b' %}background: rgba(0,200,83,0.2);{% endif %}
                        {% if item.student_answer == 'b' and item.question.correct_answer != 'b' %}background: rgba(255,82,82,0.2);{% endif %}
                    ">
                        <span style="font-weight: 600;">Ø¨)</span> {{ item.question.option_b }}
                        {% if item.question.correct_answer == 'b' %}âœ…{% endif %}
                        {% if item.student_answer == 'b' and item.question.correct_answer != 'b' %}âŒ{% endif %}
                    </div>

                    <div style="padding: 10px 15px; border-radius: 8px;
                        {% if item.question.correct_answer == 'c' %}background: rgba(0,200,83,0.2);{% endif %}
                        {% if item.student_answer == 'c' and item.question.correct_answer != 'c' %}background: rgba(255,82,82,0.2);{% endif %}
                    ">
                        <span style="font-weight: 600;">Ø¬)</span> {{ item.question.option_c }}
                        {% if item.question.correct_answer == 'c' %}âœ…{% endif %}
                        {% if item.student_answer == 'c' and item.question.correct_answer != 'c' %}âŒ{% endif %}
                    </div>

                    <div style="padding: 10px 15px; border-radius: 8px;
                        {% if item.question.correct_answer == 'd' %}background: rgba(0,200,83,0.2);{% endif %}
                        {% if item.student_answer == 'd' and item.question.correct_answer != 'd' %}background: rgba(255,82,82,0.2);{% endif %}
                    ">
                        <span style="font-weight: 600;">Ø¯)</span> {{ item.question.option_d }}
                        {% if item.question.correct_answer == 'd' %}âœ…{% endif %}
                        {% if item.student_answer == 'd' and item.question.correct_answer != 'd' %}âŒ{% endif %}
                    </div>
                </div>

                {% if item.question.explanation %}
                <div style="margin-top: 15px; padding: 15px; background: rgba(0,212,255,0.1); border-radius: 8px;">
                    <strong>ğŸ’¡ Ø§Ù„Ø´Ø±Ø­:</strong> {{ item.question.explanation }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Actions -->
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 40px;">
            <a href="{% url 'courses:lecture_detail' result.quiz.lecture.id %}" class="btn btn-outline">
                ğŸ¥ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø©
            </a>
            <a href="{% url 'users:dashboard' %}" class="btn btn-primary">
                ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
        </div>
    </div>
</div>

{% if result.passed %}
<script>
    // Celebration animation for passing
    document.addEventListener('DOMContentLoaded', celebrate);
</script>
{% endif %}
{% endblock %}